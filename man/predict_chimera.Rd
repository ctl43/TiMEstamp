% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict_chimera.R
\name{predict_chimera}
\alias{predict_chimera}
\title{Predict Chimeric Insertions}
\usage{
predict_chimera(
  folder,
  chrom = NULL,
  which_side = "upstream",
  min_len = 25,
  max_len = 1000,
  min_cov = 0.65,
  min_supporting = 15L
)
}
\arguments{
\item{folder}{Character scalar. Path to the project folder containing all
required processed inputs and where outputs will be written under
\file{processed/}.}

\item{chrom}{Character vector or \code{NULL}. Chromosomes to process. If
\code{NULL}, all available chromosomes are inferred automatically from
filenames in \file{folder/gap/}.}

\item{which_side}{Character string. Either \code{"upstream"} (5' flank) or
\code{"downstream"} (3' flank) to specify which flanking region to evaluate.
Default: \code{"upstream"}.}

\item{min_len}{Integer (bp). Minimum representative flank length to include
as a candidate segment. Default: \code{25}.}

\item{max_len}{Integer (bp). Maximum representative flank length to include.
Default: \code{1000}. The function aborts if \code{max_len < 1000} or if
\code{max_len <= min_len}.}

\item{min_cov}{Numeric in \code{[0, 1]}. Minimum clade-level coverage agreement
used internally as a missingness cutoff (\code{1 - min_cov}) for
\code{predict_timepoint()}. Default: \code{0.65}.}

\item{min_supporting}{Integer. Minimum total number of supporting flanking
segments (after filtering) required for a locus to be called. Default:
\code{15L}.}
}
\value{
Invisibly returns \code{NULL}. Called for its side effects (files written).
}
\description{
Identifies loci with putative chimeric insertions by comparing the inferred
insertion timepoints of each locus and its flanking segments across sister
clades. Loci are called as chimeric if their flank and locus timepoints
differ while passing reliability, length, and support filters.
}
\details{
The function orchestrates per-chromosome analysis via
\code{predict_chimera_by_chrom()}, performing the following steps:
\enumerate{
\item Compute insertion timepoints for loci and flanking segments using
\code{predict_timepoint()} with a coverage cutoff of \code{1 - min_cov}.
\item Enforce segment length filters (\code{min_len}, \code{max_len}).
\item Apply clade-level reliability filters to exclude unreliable loci and segments.
\item Aggregate results across flanking segment clusters, requiring at least
\code{min_supporting} total segment support per locus.
\item Output a subset of reference loci meeting all chimera criteria.
}

\strong{Expected Inputs (in \file{processed/}):}
\itemize{
\item \file{cleaned_missing_by_clade/CHROM.rds} — clade-level missing fractions for loci.
\item \file{cleaned_flanking_seg_missing_by_clade/CHROM.rds} — clade-level missing fractions for flanking segments.
\item \file{flanking_rep_len/CHROM.rds} — representative flank lengths and clustering metadata.
\item \file{flanking_seg_grp/CHROM.rds} — factor mapping segments to parent loci.
\item \file{flanking_seg_is_cladewise_unreliable/CHROM.rds} — segment-level reliability flags.
\item \file{is_cladewise_unreliable/CHROM.rds} — locus-level reliability flags.
\item \file{reference_anno/CHROM.rds} — per-chromosome reference loci.
}

\strong{Outputs:}
\itemize{
\item \file{processed/predicted_chimera_<which_side>/CHROM.rds} — loci passing
chimera criteria, with additional fields:
\code{$flanking_gcoord} (flanking genomic coordinates) and
\code{$full_range} (combined locus range).
\item \file{processed/predicted_chimera_<which_side>.txt} — combined text
summary of all chromosomes.
}

Parameter constraints are validated internally: \code{min_len > 10},
\code{max_len >= 1000}, and \code{max_len > min_len}.
}
\examples{
\dontrun{
# Predict upstream (5') chimeric insertions across all chromosomes
predict_chimera(folder = "results/mammals_project", which_side = "upstream")

# Predict downstream (3') chimeric insertions for chromosome 1 only
predict_chimera(folder = "results/mammals_project", chrom = "chr1", which_side = "downstream")
}

}
\seealso{
\code{\link{extract_flanking_segment}},
\code{\link{predict_timepoint}},
\code{\link{predict_chimera_by_chrom}}
}
