% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_flanking_segment.R
\name{extract_flanking_segment}
\alias{extract_flanking_segment}
\title{Extract representative flanking segments for target loci}
\usage{
extract_flanking_segment(folder, which_side = "upstream", chrom = NULL)
}
\arguments{
\item{folder}{Character scalar. Project folder containing required inputs and
where outputs will be written.}

\item{which_side}{Character scalar; \code{"upstream"} or \code{"downstream"}
to select the 5' or 3' flank, respectively.}

\item{chrom}{Character vector or \code{NULL}. Chromosomes to process. If
\code{NULL}, discovered from \file{folder/gap} by stripping the \code{.rds}
suffix.}
}
\value{
Invisibly returns \code{NULL}. Called for its side effects of creating
the files listed above.
}
\description{
Iterates over selected chromosomes and calls
\code{extract_flanking_segment_by_chrom()} to derive representative
upstream or downstream flanking segments. The procedure:
\enumerate{
\item loads per-locus flanking gap lengths from
\file{processed/flanking_gap_len/CHROM.rds};
\item keeps species that are consistently absent at the locus
(per clade- and species-level calls);
\item summarizes flanking lengths by cluster to obtain a representative flanking gap after masking target regions (tolerating small variation);
\item tiles each flank into segments and computes missing fractions
per species and by clade;
\item flags segments with inconsistent clade vs. species evidence.
}
}
\details{
\strong{Required inputs in \code{folder}:}
\itemize{
\item \file{sister_clades.rds}: list of species per clade.
\item \file{processed/flanking_gap_len/CHROM.rds}: data frame with columns
\code{up}, \code{dn} (from earlier steps).
\item \file{processed/cladewise_existence/CHROM.rds} and
\file{processed/loci_existence/CHROM.rds}: existence calls.
\item \file{processed/reference_anno/CHROM.rds}: chromosome-specific
reference annotation used to anchor flanks.
\item \file{gap/CHROM.rds}: per-species gap \code{GRanges} with a
\code{labels} factor for species.
}

\strong{Outputs written:}
\itemize{
\item \file{processed/flanking_rep_len/CHROM.rds}: representative flank length per locus (with clustering metadata).
\item \file{processed/flanking_seg_grp/CHROM.rds}: factor mapping segment rows to parent loci.
\item \file{processed/cleaned_flanking_seg_missing_by_clade/CHROM.rds}: clade-wise missing fractions for flanking segments after masking absent loci.
\item \file{processed/flanking_seg_is_cladewise_unreliable/CHROM.rds}: logical list flagging segments with cladeâ€“species inconsistency.
}
}
\seealso{
\code{\link{extract_flanking_segment_by_chrom}},
\code{\link{classify_existence_by_clade}},
\code{\link{expand_cladewise_to_species}},
\code{\link{get_missing_by_clades}},
\code{\link{compute_missing_portion}}
}
