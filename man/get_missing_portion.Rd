% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_missing_portion.R
\name{get_missing_portion}
\alias{get_missing_portion}
\title{Compute per-species missing fractions for target loci}
\usage{
get_missing_portion(chrom = NULL, reference_file, selected_info = NULL, folder)
}
\arguments{
\item{chrom}{Character vector or \code{NULL}. Chromosome names to process.
If \code{NULL}, chromosomes are discovered from filenames under
\file{folder/gap} by stripping the \code{.rds} suffix.}

\item{reference_file}{Character scalar. Path to an RDS file containing the
reference annotation as a \code{GRanges} or \code{CompressedGRangesList}.
The object may carry metadata columns used by \code{selected_info}.}

\item{selected_info}{Character or \code{NULL}. Optional selector of a
metadata column in the reference annotation that defines the genomic
intervals to analyze. Must be one of \code{"members"}, \code{"fivep_frag"},
\code{"threep_frag"}, or \code{NULL}. When \code{NULL}, the top-level
\code{GRanges} or \code{GRangesList} is used as is.}

\item{folder}{Character scalar. Project folder that contains the gap files
under \file{gap/} and will receive outputs under \file{processed/}.}
}
\value{
Invisibly returns \code{NULL}. This function is called for its side effects
of creating per-chromosome missing-fraction matrices.
}
\description{
Iterates over selected chromosomes and computes, for each locus in the
reference annotation, the fraction of alignment that is missing for each
species. Results are written as per-chromosome matrices under
\file{processed/missing_portion/}. This wrapper validates inputs, restricts
the reference annotation to requested chromosomes, and dispatches work to
\code{get_missing_portion_by_chrom()}.
}
\details{
\strong{Input layout expected under \code{folder}:}
\itemize{
\item \file{gap/CHROM.rds}: a \code{GRanges} of gap intervals per species for chromosome \code{CHROM}.
The \code{labels} column must be a factor giving species identifiers.
\item \file{sister_clades.rds}: a list of character vectors defining species per clade.
}

\strong{Reference annotation in \code{reference_file}:}
\itemize{
\item A \code{GRanges} or \code{CompressedGRangesList} of loci.
\item If \code{selected_info = "members"}, a \code{GRangesList} column
\code{$members} is used.
\item If \code{selected_info = "fivep_frag"} or \code{"threep_frag"},
the corresponding \code{GRanges} column is used.
}

\strong{Outputs written by this wrapper and its worker:}
\itemize{
\item \file{processed/reference_anno/CHROM.rds}: the per-chromosome subset of the reference annotation.
\item \file{processed/missing_portion/CHROM.rds}: a numeric matrix with rows as loci and columns as species
giving missing fractions in [0, 1].
}
If a chromosome contains more than 50,000 reference entries, the function
stops with a message. Consider subsetting the annotation or using the
clade-level pipeline (\code{\link{get_missing_coverage_by_clade_fast}},
\code{\link{clean_clade_data_fast}}, \code{\link{get_timepoint_fast}})
to reduce runtime and memory usage.
}
\section{Typical workflow}{

\enumerate{
\item Prepare \file{gap/CHROM.rds} files and \file{sister_clades.rds}.
\item Prepare \code{reference_file} as an RDS of \code{GRanges} or \code{GRangesList}.
\item Call \code{get_missing_portion()} to populate \file{processed/missing_portion/}.
\item Downstream functions such as \code{classify_existence()} and \code{inspect_loci()}
can then be applied.
}
}

\examples{
\dontrun{
# Using all chromosomes discovered in folder/gap
get_missing_portion(
  chrom = NULL,
  reference_file = "reference_anno.rds",
  selected_info = NULL,
  folder = "my_project"
)

# Using a metadata column that holds 5' fragments
get_missing_portion(
  chrom = c("chr1", "chr2"),
  reference_file = "reference_anno.rds",
  selected_info = "fivep_frag",
  folder = "my_project"
)
}

}
